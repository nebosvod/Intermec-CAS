1  LTS& ON
10 ON ERROR GOTO 9500
12 AD$="" : CD$="00000" : W1$="" : W2$="" : AFN%=0 : AFS$="" : OTCH%=0 : OTCHS$=""
14 PA$="" : DT$="" : AF%=0 : W3$="" : W3SUM$="0" : PAR$="" : FL%=0 : DV$=""
20 FB%=0
40 WEIGHT$=""
50 'OPEN "table.csv" FOR OUTPUT AS 23
52 'PRINT #23,"№ п/п;Номер партии;Номер коробки;Масса нетто,кг;" 
54 'CLOSE 23
80 SETSTDIO 0
100 A$=INKEY$
101 PRINT " VES= "+W3$
'Если нажата клавиша "Стрелка вниз" - переход на процедуру номер партии, строка 5000
'Если нажата клавиша "Стрелка вверх" - переход на процедуру даты изготовления, строка 5200
'Если нажата клавиша "Стрелка влево" - переход на процедуру наименование, строка 5400
'Если нажата клавиша "Стрелка вправо" - переход на процедуру даты выработки, строка 5610
'Если нажата клавиша "I" - переход на процедуру выгрузки, строка 6158
'Если нажата клавиша "Setup" - переход на процедуру запроса сброса спецификации, строка 4700
119 IF ASC(A$)=4 THEN GOSUB PART
120 IF ASC(A$)=5 THEN GOSUB OTCHETVIG 
121 IF ASC(A$)=29 THEN GOSUB REQSBRSP
123 IF ASC(A$)=2 THEN GOSUB WDATA
124 IF ASC(A$)=1 THEN GOSUB WNAME
125 IF ASC(A$)=31 THEN GOSUB DISP
127 IF ASC(A$)=3 THEN GOSUB WDATAI
128 IF ASC(A$)=28 THEN FORMFEED
129 IF ASC(A$)=8 THEN GOSUB EN
130 GOTO 100
200 DISP: 
201 OPEN "console:" FOR OUTPUT AS 3
202 GOSUB WS
203 CLOSE 3
205 OPEN "console:" FOR OUTPUT AS 31
206 PRINT #31 : PRINT #31
207 PRINT #31, LEFT$("LOAD PLATFORM",16) : PRINT #31, LEFT$("PRESS ENTER",16);
208 B$=INKEY$
209 IF ASC(B$)=31 THEN GOTO 211
210 GOTO 208
211 CLOSE 31
214 GOSUB PNAM1
215 GOSUB LBEL
216 RETURN
217 WS: 
218 IF FB%=1 THEN GOTO 1740
690 PRINT #3 : PRINT #3
700 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
710 A$=INKEY$
720 IF A$=CHR$(13) THEN GOTO 1140
730 IF A$=CHR$(8) THEN 
740 AD$=LEFT$(AD$,LEN(AD$)-1)
742 'AD$="000"+AD$
744 'AD$=RIGHT$(AD$,3)
750 PRINT #3 : PRINT #3
760 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
770 END IF
780 IF ASC(A$)>47 AND ASC(A$)<58 THEN 
790 AD$=AD$+A$
792 'AD$="000"+AD$
794 AD$=LEFT$(AD$,3)
800 PRINT #3 : PRINT #3
810 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
820 END IF
830 GOTO 710
1140 PRINT #3 : PRINT #3
1150 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
1160 A$=INKEY$
1170 IF A$=CHR$(13) THEN GOTO 1440
1180 IF A$=CHR$(8) THEN 
1190 DT$=LEFT$(DT$,LEN(DT$)-1)
1200 PRINT #3 : PRINT #3
1210 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
1220 END IF
1230 IF ASC(A$)>45 AND ASC(A$)<58 THEN 
1240 DT$=DT$+A$
1244 DT$=LEFT$(DT$,10)
1250 PRINT #3 : PRINT #3
1260 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
1270 END IF
1280 GOTO 1160
1440 PRINT #3 : PRINT #3
1450 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
1460 A$=INKEY$
1470 IF A$=CHR$(13) THEN GOTO 1600
1480 IF A$=CHR$(8) THEN 
1490 PA$=LEFT$(PA$,LEN(PA$)-1)
1500 PRINT #3 : PRINT #3
1510 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
1520 END IF
1530 IF ASC(A$)>47 AND ASC(A$)<58 THEN 
1540 PA$=PA$+A$
1544 PA$=LEFT$(PA$,2)
1550 PRINT #3 : PRINT #3
1560 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
1570 END IF
1580 GOTO 1460
'Ввод данных "Дата выработки"
1600 PRINT #3 : PRINT #3
1610 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
1620 A$=INKEY$
1630 IF A$=CHR$(13) THEN GOTO 1740
1640 IF A$=CHR$(8) THEN 
1650 DV$=LEFT$(DV$,LEN(DV$)-1)
1660 PRINT #3 : PRINT #3
1670 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
1680 END IF
1690 IF ASC(A$)>45 AND ASC(A$)<58 THEN 
1700 DV$=DV$+A$
1705 DV$=LEFT$(DV$,10)
1710 PRINT #3 : PRINT #3
1715 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
1720 END IF
1725 GOTO 1620
'Конец ввода данных
1740 FB%=1 : RETURN
1850 LBEL: 
1860 GOSUB VWEIGHT
1870 DIR 1 : ALIGN 8 : CLIP ON
1880 NASC 1251
1890 FONT "Arial",10,0,100
1900 PRPOS 225,302
1910 PRTXT PNAME7$
2360 DIR 1 : ALIGN 8 : CLIP ON
2370 NASC 1251
2380 FONT "Arial",10,0,100
2390 PRPOS 225,266
2400 PRTXT PNAME2$
2600 DIR 1 : ALIGN 8 : CLIP ON
2610 NASC 1251
2620 FONT "Arial",12,0,100
2630 PRPOS 225,165
2640 PRTXT "Масса нетто:  "+NE$+" кг"
2660 'DIR 1 : ALIGN 7 : CLIP ON
2670 'NASC 1251
2680 'FONT "Arial",8,0,100
2690 'PRPOS 677,187
2700 'IF W3$="" THEN W3$="0"
2710 'IF CD$="" THEN CD$="0"
2720 'WE$=FLOATCALC$(W3$,"+",CD$,2)
2730 'PRTXT "Масса брутто             "+WE$+"   кг"
2740 DIR 1 : ALIGN 7 : CLIP ON
2742 NASC 1251
2744 FONT "Arial",8,0,100
2746 PRPOS 250,225
2748 PRTXT "Срок годности:"
2750 DIR 1 : ALIGN 7 : CLIP ON
2752 NASC 1251
2754 FONT "Arial",8,0,100
2756 PRPOS 250,200
2758 PRTXT PNAME3$
2760 DIR 1 : ALIGN 7 : CLIP ON
2770 NASC 1251
2780 FONT "Arial",8,0,100
2790 PRPOS 21,225
2800 PRTXT "Дата изготовления:"
2802 DIR 1 : ALIGN 7 : CLIP ON
2804 NASC 1251
2806 FONT "Arial",8,0,100
2808 PRPOS 21,200
2810 PRTXT DT$
2850 DIR 1 : ALIGN 8 : CLIP BARCODE ON
2851 PRPOS 225,100
2852 BARTYPE "EAN13"
2853 BARHEIGHT 50
2854 BARMAG 3
2855 BARFONT "Swiss 721 BT",10,0,1,1,1,100 ON
'2856 FOR I%=1 TO LEN(W3SUM$) STEP 1
'2857 IF MID$(W3SUM$,I%,1)<>" " AND MID$(W3SUM$,I%,1)<>"." AND MID$(W3SUM$,I%,1)<>"-" THEN W1$=W1$+MID$(W3SUM$,I%,1)
'2858 NEXT
'Доработка значений веса для штрих кода, почему то до этого суммировался вес продукта для 2 и более этикеток
2856 FOR I%=1 TO LEN(NE$) STEP 1
2857 IF MID$(NE$,I%,1)<>" " AND MID$(NE$,I%,1)<>"," AND MID$(NE$,I%,1)<>"-" THEN W1$=W1$+MID$(NE$,I%,1)
2858 NEXT
2890 W2$="00000"
2891 W2$=W2$+W1$
2894 W2$=RIGHT$(W2$,5)
2896 PNAME6$=PNAME6$+"0000000"
2897 PNAME6$=LEFT$(PNAME6$,7)
2898 PRBAR PNAME6$+W2$
2900 CLEANFEED -105
2901 PRINTFEED 
2902 IF FLAG1%=1 THEN AF%=AF%+1 ELSE W3SUM$="0"
2903 IF PNAME5$=STR$(AF%) THEN
2904 DIR 1 : ALIGN 8 : CLIP ON
2905 NASC 1251
2906 FONT "Arial",8,0,100
2907 PRPOS 225,310
2908 PRTXT PNAME7$
'2904 DIR 1 : ALIGN 7 : CLIP ON
'2906 NASC 1251
'2908 FONT "Arial",7,0,100
'2910 PRPOS 10,210
'2912 PX 60,464,0,PNAME1$,0,-10
2909 DIR 1 : ALIGN 8 : CLIP ON
2910 NASC 1251
2911 FONT "Arial",8,0,100
2912 PRPOS 225,270
2913 PRTXT PNAME2$
2930 DIR 1 : ALIGN 7 : CLIP ON
2932 NASC 1251
2934 FONT "Arial",7,0,100
2936 PRPOS 320,210
2938 PRTXT "Масса нетто:"
2940 DIR 1 : ALIGN 7 : CLIP ON
2942 NASC 1251
2944 FONT "Arial",7,0,100
2946 PRPOS 320,190
2948 PRTXT NESUM$+" кг"
2950 DIR 1 : ALIGN 7 : CLIP ON
2951 NASC 1251
2952 FONT "Arial",7,0,100
2953 PRPOS 320,160
2954 PRTXT "Масса брутто:"
2955 DIR 1 : ALIGN 7 : CLIP ON
2956 NASC 1251
2957 FONT "Arial",7,0,100
2958 PRPOS 320,140
' Исправил  с 1 на 3 для веса в тясячных
2959 WE$=FLOATCALC$(W3SUM$,"+",PNAME4$,3)
2960 WE1$=""
2961 FOR I%=1 TO LEN(WE$) STEP 1
2962 I1$=MID$(WE$,I%,1)
2963 IF I1$="." THEN I1$=","
2964 WE1$=WE1$+I1$
2965 NEXT
2968 PRTXT WE1$+" кг"
2970 DIR 1 : ALIGN 7 : CLIP ON
2972 NASC 1251
2974 FONT "Arial",7,0,100
2976 PRPOS 195,160
2978 PRTXT "Партия №:"
2980 DIR 1 : ALIGN 7 : CLIP ON
2982 NASC 1251
2984 FONT "Arial",7,0,100
2986 PRPOS 195,140
2987 PAR$=LEFT$(DV$,2)+"/"+MID$(DV$,4,2)+"-"+PA$
2988 IF PA$<>"" THEN PRTXT PAR$ ELSE PRTXT ""
2990 DIR 1 : ALIGN 7 : CLIP ON
2992 NASC 1251
2994 FONT "Arial",7,0,100
2996 PRPOS 195,210
2998 PRTXT "Коробка №:"
2999 GOSUB KOR
3000 AFN%=AFN%+1
3001 DIR 1 : ALIGN 7 : CLIP ON
3002 NASC 1251
3004 FONT "Arial",7,0,100
3006 PRPOS 195,190
3008 PRTXT STR$(AFN%)
3009 GOSUB KORZ
3010 DIR 1 : ALIGN 7 : CLIP ON
3012 NASC 1251
3014 FONT "Arial",7,0,100
3016 PRPOS 10,160
3018 PRTXT "Срок годности:"
3020 DIR 1 : ALIGN 7 : CLIP ON
3022 NASC 1251
3024 FONT "Arial",7,0,100
3026 PRPOS 10,140
3028 PRTXT PNAME3$
3030 DIR 1 : ALIGN 7 : CLIP ON
3032 NASC 1251
3034 FONT "Arial",7,0,100
3036 PRPOS 10,210
3038 PRTXT "Дата изготовления:"
3040 DIR 1 : ALIGN 7 : CLIP ON
3042 NASC 1251
3044 FONT "Arial",7,0,100
3046 PRPOS 10,190
3048 PRTXT DT$
3050 DIR 1 : ALIGN 8 : CLIP BARCODE ON
3052 PRPOS 225,100
3054 BARTYPE "EAN13"
3056 BARHEIGHT 50
3058 BARMAG 3
3060 BARFONT "Swiss 721 BT",10,0,1,1,1,100 ON
3062 FOR I%=1 TO LEN(W3SUM$) STEP 1
3064 IF MID$(W3SUM$,I%,1)<>" " AND MID$(W3SUM$,I%,1)<>"." AND MID$(W3SUM$,I%,1)<>"-" THEN W1$=W1$+MID$(W3SUM$,I%,1)
3066 NEXT
3068 W2$="00000"
3070 W2$=W2$+W1$
3072 W2$=RIGHT$(W2$,5)
3074 PNAME6$=PNAME6$+"0000000"
3076 PNAME6$=LEFT$(PNAME6$,7)
3100 PRBAR PNAME6$+W2$
3110 GOSUB OTCHET
3500 CLEANFEED -105
3502 PRINTFEED
3503 AF%=0 : W3SUM$="0" : FL%=1 : END IF
3504 W2$="" : W1$=""
3506 RETURN
4000 PNAM1: 
' Добавление переменных из справочника товаров PLUES2
4010 PNAME1$="" : PNAME2$="" : PNAME3$="" : PNAME4$="" : PNAME5$="" : PNAME6$="" : PNAME7$="" : PNAME8$="" : PNAME9$="" : PNAME10$=""
'4010 PNAME1$="" : PNAME2$="" : PNAME3$="" : PNAME4$="" : PNAME5$="" : PNAME6$=""
4020 OPEN "plues2.txt" FOR INPUT AS 11
4030 FLAG%=0 : FLAG1%=0
4040 WHILE FLAG%<1
4050 INPUT #11, MTMP$
4060 LUTMP$=""
4070 IF LEFT$(MTMP$,6)="PLUNO=" THEN LUTMP$=MID$(MTMP$,7)
4072 IF (LUTMP$="") OR (LUTMP$=" ") THEN GOTO 4240
4080 IF LUTMP$=AD$ THEN
4090 LINE INPUT #11, PNAME1$
4100 IF LEFT$(PNAME1$,6)="NAME1=" THEN PNAME1$=MID$(PNAME1$,7)
4102 LINE INPUT #11, PNAME2$
4104 IF LEFT$(PNAME2$,6)="NAME2=" THEN PNAME2$=MID$(PNAME2$,7)
4106 LINE INPUT #11, PNAME3$
4108 IF LEFT$(PNAME3$,6)="GODEN=" THEN PNAME3$=MID$(PNAME3$,7)
4110 LINE INPUT #11, PNAME4$
4112 IF LEFT$(PNAME4$,7)="VESKOR=" THEN PNAME4$=MID$(PNAME4$,8)
4114 LINE INPUT #11, PNAME5$
4116 IF LEFT$(PNAME5$,9)="INTERVAL=" THEN PNAME5$=MID$(PNAME5$,10)
4118 LINE INPUT #11, PNAME6$
4120 IF LEFT$(PNAME6$,7)="KODTOV=" THEN PNAME6$=MID$(PNAME6$,8)
4122 LINE INPUT #11, PNAME7$
4124 IF LEFT$(PNAME7$,8)="NAMEORG=" THEN PNAME7$=MID$(PNAME7$,9)
4126 LINE INPUT #11, PNAME8$
4128 IF LEFT$(PNAME8$,9)="TOCHNOST=" THEN PNAME8$=MID$(PNAME8$,10)
4130 LINE INPUT #11, PNAME9$
4132 IF LEFT$(PNAME9$,11)="OKRUGLENIE=" THEN PNAME9$=MID$(PNAME9$,12)
4134 LINE INPUT #11, PNAME10$
4136 IF LEFT$(PNAME10$,8)="USUSHKA=" THEN PNAME10$=MID$(PNAME10$,9)
4220 FLAG%=1 : FLAG1%=1
4230 END IF
4240 IF EOF(11) THEN FLAG%=1
4250 WEND
4260 CLOSE 11
4270 RETURN
' Процедура получения данных с весов
4500 VWEIGHT: 
4501 DTA$="" : WEIGHT$="" : W3$="" : NE$="" : NESUM$="" : SETSTDIO 1
4506 OPEN "uart1:" FOR OUTPUT AS 12
4508 PRINT #12, "D"
4521 CLOSE 12
4526 DTA$=DTA$+INKEY$
4527 OPEN "console:" FOR OUTPUT AS 3
4528 PRINT #3, MID$(DTA$,10,10)
4529 CLOSE 3
4530 IF LEN(DTA$)<22 THEN GOTO 4526
' Отбрасывание сотых веса, округление до десятых
'4590 WEIGHT$=MID$(DTA$,10,7)
' Получение полной информации о весе, только до сотых грамма
4590 WEIGHT$=MID$(DTA$,10,8)
' Добавление нуля для получения веса с весов в тысячных
4591 WEIGHT$=WEIGHT$ + "0"
' Получение значения веса из входящей строки с весов в КГ
4592 FOR I%=1 TO LEN(WEIGHT$) STEP 1
4593 IF MID$(WEIGHT$,I%,1)<>" " THEN W3$=W3$+MID$(WEIGHT$,I%,1)
4594 NEXT
'4594 W3SUM$=FLOATCALC$(W3SUM$,"+",W3$,1)
'Сумма значений, "3" - количество знаков после запятой
4595 W3SUM$=FLOATCALC$(W3SUM$,"+",W3$,3)
4596 FOR I%=1 TO LEN(W3$) STEP 1
4597 I1$=MID$(W3$,I%,1)
4598 IF I1$="." THEN I1$=","
4600 NE$=NE$+I1$
4602 NEXT
4604 FOR I%=1 TO LEN(W3SUM$) STEP 1
4605 I1$=MID$(W3SUM$,I%,1)
4606 IF I1$="." THEN I1$=","
4608 NESUM$=NESUM$+I1$
4610 NEXT
'Вывод веса в консоль
4620 OPEN "console:" FOR OUTPUT AS 55
4630 PRINT #55, LEFT$(NE$,16) : PRINT #55, LEFT$(W3$,16);
4660 SETSTDIO 0
4680 RETURN
' Конец процедуры получение данных с весов
' Процедура запроса удаления спецификации
4700 REQSBRSP:
4710 OPEN "console:" FOR OUTPUT AS 55
4720 PRINT #55, LEFT$("DELETE ?",16) : PRINT #55, LEFT$("YES=ENTER, C=NO",16);
4730 D$=INKEY$
4735 IF D$ = "" GOTO 4730
4740 IF ASC(D$)=13 THEN GOSUB OTCHETSBR 
4750 IF ASC(D$)=8 THEN GOTO 4760
4760 CLOSE 55
4800 RETURN
' Конец процедуры запроса удаления спецификации
5000 PART: 
5010 OPEN "console:" FOR OUTPUT AS 3
5020 PRINT #3 : PRINT #3
5030 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
5040 C$=INKEY$
5060 IF C$=CHR$(13) THEN GOTO 5180
5070 IF C$=CHR$(8) THEN 
5080 PA$=LEFT$(PA$,LEN(PA$)-1)
5090 PRINT #3 : PRINT #3
5100 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
5110 END IF
5120 IF ASC(C$)>47 AND ASC(C$)<58 THEN 
5130 PA$=PA$+C$
5134 PA$=LEFT$(PA$,2)
5140 PRINT #3 : PRINT #3
5150 PRINT #3, LEFT$("PARTNO: ",16) : PRINT #3, LEFT$(PA$,16);
5160 END IF
5170 GOTO 5040
5180 CLOSE 3
5190 RETURN
5200 WDATA: 
5210 OPEN "console:" FOR OUTPUT AS 3
5220 PRINT #3 : PRINT #3
5230 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
5240 C$=INKEY$
5260 IF C$=CHR$(13) THEN GOTO 5380
5270 IF C$=CHR$(8) THEN 
5280 DT$=LEFT$(DT$,LEN(DT$)-1)
5290 PRINT #3 : PRINT #3
5300 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
5310 END IF
5320 IF ASC(C$)>45 AND ASC(C$)<58 THEN 
5330 DT$=DT$+C$
5334 DT$=LEFT$(DT$,10)
5340 PRINT #3 : PRINT #3
5350 PRINT #3, LEFT$("DATA IZGOT: ",16) : PRINT #3, LEFT$(DT$,16);
5360 END IF
5370 GOTO 5240
5380 CLOSE 3
5390 RETURN
5400 WNAME: 
5410 OPEN "console:" FOR OUTPUT AS 3
5420 PRINT #3 : PRINT #3
5430 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
5440 C$=INKEY$
5460 IF C$=CHR$(13) THEN GOTO 5580
5470 IF C$=CHR$(8) THEN 
5480 AD$=LEFT$(AD$,LEN(AD$)-1)
5482 'AD$="000"+AD$
5484 'AD$=RIGHT$(AD$,3)
5490 PRINT #3 : PRINT #3
5500 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
5510 END IF
5520 IF ASC(C$)>47 AND ASC(C$)<58 THEN 
5530 AD$=AD$+C$
5532 'AD$="000"+AD$
5534 AD$=LEFT$(AD$,3)
5540 PRINT #3 : PRINT #3
5550 PRINT #3, LEFT$("HAIM1: ",16) : PRINT #3, LEFT$(AD$,16);
5560 END IF
5570 GOTO 5440
5580 CLOSE 3
5590 RETURN
5610 WDATAI: 
5620 OPEN "console:" FOR OUTPUT AS 3
5630 PRINT #3 : PRINT #3
5640 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
5650 C$=INKEY$
5660 IF C$=CHR$(13) THEN GOTO 5790
5670 IF C$=CHR$(8) THEN 
5680 DV$=LEFT$(DV$,LEN(DV$)-1)
5690 PRINT #3 : PRINT #3
5700 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
5710 END IF
5720 IF ASC(C$)>45 AND ASC(C$)<58 THEN 
5730 DV$=DV$+C$
5740 DV$=LEFT$(DV$,10)
5750 PRINT #3 : PRINT #3
5760 PRINT #3, LEFT$("DATA VIR: ",16) : PRINT #3, LEFT$(DV$,16);
5770 END IF
5780 GOTO 5650
5790 CLOSE 3
5800 RETURN
6000 KOR: 
6010 OPEN "korob.txt" FOR INPUT AS 22
6020 INPUT #22, AFS$
6030 IF AFS$="" THEN AFS$="0"
6040 AFN%=VAL(AFS$)
6050 CLOSE 22
6060 RETURN
6070 KORZ: 
6080 OPEN "korob.txt" FOR OUTPUT AS 22
6090 PRINT #22, STR$(AFN%)+CHR$(13)
6100 CLOSE 22
6110 RETURN
6120 OTCHET: 
6125 GOSUB OTCHTEN
6130 OPEN "table.csv" FOR APPEND AS 23
6135 OTCH%=OTCH%+1
6140 PRINT #23,STR$(OTCH%)+"; "+PAR$+";"+STR$(AFN%)+";"+NESUM$+";"
6145 CLOSE 23
6150 GOSUB OTZAP
6155 RETURN
6158 OTCHETVIG: 
6160 OPEN "shapka.txt" FOR OUTPUT AS 28
6161 PRINT #28,PNAME4$+CHR$(13)
6162 PRINT #28,PNAME7$+CHR$(13)
6164 PRINT #28,PNAME1$+CHR$(13)
6166 PRINT #28,DT$+CHR$(13)
6168 PRINT #28,STR$(OTCH%)+CHR$(13)
6170 CLOSE 28
6172 OPEN "console:" FOR OUTPUT AS 3
6174 PRINT #3 : PRINT #3
6176 PRINT #3, LEFT$("IP: ",16) : PRINT #3, LEFT$(OT$,16);
6178 C$=INKEY$
6180 IF C$=CHR$(13) THEN GOTO 6208
6182 IF C$=CHR$(8) THEN 
6184 OT$=LEFT$(OT$,LEN(OT$)-1)
6186 PRINT #3 : PRINT #3
6188 PRINT #3, LEFT$("IP: ",16) : PRINT #3, LEFT$(OT$,16);
6190 END IF
6192 IF ASC(C$)>45 AND ASC(C$)<58 THEN 
6194 OT$=OT$+C$
6196 OT$=LEFT$(OT$,15)
6198 PRINT #3 : PRINT #3
6200 PRINT #3, LEFT$("IP: ",16) : PRINT #3, LEFT$(OT$,16);
6202 END IF
6204 GOTO 6178
6206 CLOSE 3
6208 TRANSFER NET "TABLE.CSV","ftp://"+OT$
6209 TRANSFER NET "SHAPKA.TXT","ftp://"+OT$
6210 RETURN
6320 OTCHETSBR:
6321 OTCH%=0
6322 OPEN "table.csv" FOR OUTPUT AS 23
6323 PRINT #23,"№ п/п;Номер партии;Номер коробки;Масса нетто,кг;" 
6324 CLOSE 23
6325 OPEN "otchetno.txt" FOR OUTPUT AS 23
6326 PRINT #23,"" 
6327 CLOSE 23
6330 OPEN "console:" FOR OUTPUT AS 55
6331 PRINT #55, LEFT$("OTCHET STERT",16) : PRINT #55, LEFT$("Press Enter",16);
6332 D$=INKEY$
6333 IF D$ = "" GOTO 6332
6335 IF ASC(D$)=8 THEN GOTO 6336
6336 CLOSE 55
6350 RETURN
6430 OTCHTEN: 
6432 OPEN "otchetno.txt" FOR INPUT AS 44
6434 INPUT #44, OTCHS$
6436 IF OTCHS$="" THEN OTCHS$="0"
6438 OTCH%=VAL(OTCHS$)
6440 CLOSE 44
6442 RETURN
6444 OTZAP: 
6446 OPEN "otchetno.txt" FOR OUTPUT AS 44
6448 PRINT #44, STR$(OTCH%)+CHR$(13)
6450 CLOSE 44
6452 RETURN
9000 EN: 
9010 SETSTDIO 100
9020 OPEN "console:" FOR OUTPUT AS 10
9030 PRINT #10 : PRINT #10
9040 PRINT #10, LEFT$("PROGRAM END",16)
9050 CLOSE 10
9060 END
9500 OER: 
9530 IF ERR=1005 OR ERR=1031 THEN 
9535 PRINT "" : PRINT "" : PRINT "RULON OFF "+STR$(ERR)
9540 AR$=INKEY$
9550 IF ASC(AR$)=28 THEN 
9560 FORMFEED
9570 GOTO 9610
9580 END IF
9590 GOTO 9540
9600 END IF
9608 PRINT "" : PRINT "" : PRINT "UNKNOWN "+STR$(ERR)
9610 RESUME NEXT
9650 WFLASH:
9660 'OPEN "console:" FOR OUTPUT AS 37
9670 'PRINT #37 : PRINT #37
9680 'PRINT #37, "Downloading..."
9690 'CLOSE #37
9700 'COPY "card1:plues2.txt","plues2.txt"
9710 'COPY "card1:fio.txt","fio.txt" 
9720 'COPY "card1:smena.txt","smena.txt"
9730 'OPEN "console:" FOR OUTPUT AS 37
9740 'PRINT #37 : PRINT #37
9750 'PRINT #37, "Done"
9760 'CLOSE #37
9770 RETURN
